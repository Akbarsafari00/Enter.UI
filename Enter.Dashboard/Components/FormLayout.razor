@using System.ComponentModel.DataAnnotations
@using Enter.Dashboard.Model;
@using Enter.UI.Core.Constants
<EntCard class="m-4">
    <CardHeader>صفحه فرم</CardHeader>
    <CardBody>
        <EditForm class="ent-edit-form" Model="Input" OnSubmit="@OnSubmit">
            <DataAnnotationsValidator />
            <div class="row">
                <div class="tablet:col-1/3 mb-4 ent-form-group">
                    <label>شناسه</label>
                    <EntInputText Disabled="true" @bind-Value="Input.Id" Icon="@EntIcons.ChevronLeft" />
                    <ValidationMessage For="() => Input!.Id" />
                </div>
                <div class="tablet:col-1/3 mb-4 ent-form-group">
                    <label>کاربر</label>
                    <EntInputAutoComplete @bind-Value="Input.User"
                                          ValueFunc="x=>x.Name"
                                          TextFunc="x=>x.Name"
                                          DataSources="DataSource"
                                          Icon="@EntIcons.Search"
                                          OnSearchChange="OnLastNameSearchChange"/>
                    <ValidationMessage For="() => Input!.User" />
                </div>
                <div class="tablet:col-1/3 mb-4 ent-form-group">
                    <label>نقش</label>

                    <EntInputSelect @bind-Value="Input.Role"
                               PlaceHolder="نقش مورد نظر را انتخاب نمایید"
                               DataSources="Constants.Roles"
                               ValueFunc="x=>x.Value"
                               TextFunc="x=>x.Title" />

                    <ValidationMessage For="() => Input!.Role" />
                </div>
                <div class="tablet:col-1/3 mb-4 ent-form-group">
                    <label>سن</label>
                    <EntInputText @bind-Value="Input.Age" />
                    <ValidationMessage For="() => Input!.Age" />
                </div>
            </div>
            <div class="row">
                <div class="tablet:col-1/3">
                    <EntButton type="submit">ارسال</EntButton>
                </div>
            </div>
        </EditForm>
    </CardBody>
</EntCard>

@code {

    public class InputModel
    {
        public string Id { get; set; } = Guid.NewGuid().ToString();

        [Required(ErrorMessage = "کاربر اجباری میباشد")]
        public string User { get; set; }


        [Required(ErrorMessage = "سن اجباری میباشد")]
        public string Age { get; set; }

        [Required(ErrorMessage = "نقش اجباری میباشد")]
        public string Role { get; set; }
    }

    public InputModel Input { get; set; } = new InputModel()
    {
        User = "اکبر",
        Role = "Admin"
    };

    private async Task OnSubmit()
    {
        Input.Role = "Developer";
        StateHasChanged();
        Console.WriteLine(Input.User);
    }



    public List<Users> DataSource = new List<Users>();


    protected override void OnInitialized()
    {


        DataSource = Constants.Users;

        base.OnInitialized();
    }

    private void OnLastNameSearchChange(string search)
    {
        if (search is null)
            return;
        DataSource = Constants.Users.Where(x => x.LastName.ToLower().Contains(search.ToLower())).ToList();

        StateHasChanged();
    }

}