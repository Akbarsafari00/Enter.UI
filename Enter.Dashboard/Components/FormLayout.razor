@using System.ComponentModel.DataAnnotations
@using Enter.UI.Core.Constants
<EntCard class="m-4">
    <CardHeader>صفحه فرم</CardHeader>
    <CardBody>
        <EditForm class="ent-edit-form" Model="Input" OnValidSubmit="@OnSubmit">
            <DataAnnotationsValidator />
            <div class="row">
                <div class="tablet:col-1/3 mb-4 ent-form-group">
                    <label>نام</label>
                    <EntTextInput @bind-Value="Input.FirstName" Icon="@Icons.ChevronLeft" />
                    <ValidationMessage For="() => Input!.FirstName" />
                </div>
                <div class="tablet:col-1/3 mb-4 ent-form-group">
                    <label>نام خانوادگی</label>
                    <EntAutoCompleteInput SelectedValue="x=>x.LastName"
                                          SelectedText="x=>x.LastName"
                                          DataSources="DataSource"
                                          Icon="@Icons.Search"
                    @bind-Value="Input.LastName"
                                          OnSearchChange="OnLastNameSearchChange">
                        <Template Context="item">
                            @item.FirstName @item.LastName
                        </Template>
                    </EntAutoCompleteInput>
                    <ValidationMessage For="() => Input!.LastName" />
                </div>
                <div class="tablet:col-1/3 mb-4 ent-form-group">
                    <label>شهر</label>

                    <EntSelect @bind-Value="Input.City">
                        <EntSelectItem Value="urmia" Text="ارومیه"/>
                        <EntSelectItem Value="tabriz" Text="تبریز" />
                    </EntSelect>
                    <ValidationMessage For="() => Input!.City" />
                </div>
                <div class="tablet:col-1/3 mb-4 ent-form-group">
                    <label>سن</label>
                    <EntTextInput @bind-Value="Input.Age" />
                    <ValidationMessage For="() => Input!.Age" />
                </div>
            </div>
            <div class="row">
                <div class="tablet:col-1/3">
                    <EntButton type="submit">ارسال</EntButton>
                </div>
            </div>
        </EditForm>
    </CardBody>
</EntCard>

@code {

    public class InputModel
    {
        [Required(ErrorMessage = "نام اجباری میباشد")]
        public string FirstName { get; set; }

        [Required(ErrorMessage = "نام خانوادگی اجباری میباشد")]
        public string LastName { get; set; }

        [Required(ErrorMessage = "شهر اجباری میباشد")]
        public string City { get; set; }

        [Required(ErrorMessage = "سن اجباری میباشد")]
        public string Age { get; set; }
    }

    public InputModel Input { get; set; } = new InputModel();

    private async Task OnSubmit()
    {
        Console.WriteLine(Input.FirstName);
    }



    public List<InputModel> UsersList { get; set; } = new List<InputModel>();
    public List<InputModel> DataSource { get; set; } = new List<InputModel>();


    protected override void OnInitialized()
    {
        UsersList.Add(new InputModel()
            {

                FirstName = "Akbar",
                LastName = "Ahmadi",
                Age = "28"
            });
        UsersList.Add(new InputModel()
            {

                FirstName = "Vahid",
                LastName = "Rasouli",
                Age = "35"
            });
        UsersList.Add(new InputModel()
            {

                FirstName = "Hadi",
                LastName = "Ahmadi",
                Age = "23"
            });

        DataSource = UsersList;

        base.OnInitialized();
    }

    private void OnLastNameSearchChange(string search)
    {
        if (search is null)
            return;
        DataSource = UsersList.Where(x => x.LastName.ToLower().Contains(search.ToLower())).ToList();

        StateHasChanged();
    }

}